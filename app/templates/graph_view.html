<!DOCTYPE html>
<html>
<head>
    <title>Grafo del Péptido</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
    <h2>Visualización de Grafo – Péptido {{ peptide_id }}</h2>
    <div id="graph" style="width: 100%; height: 600px;"></div>

    <!-- Bloque seguro de datos JSON -->
    <script id="graph-data" type="application/json">
        {
            "nodes": {{ nodes | tojson | safe }},
            "edges": {{ edges | tojson | safe }}
        }
    </script>

    <script>
        // Parsear los datos desde la etiqueta <script type="application/json">
        const data = JSON.parse(document.getElementById("graph-data").textContent);
        const nodes = data.nodes;
        const edges = data.edges;

        // Asignar coordenadas aleatorias (o later layout con vis.js si se desea)
        const node_x = nodes.map(() => Math.random());
        const node_y = nodes.map(() => Math.random());

        const edge_x = [], edge_y = [];
        edges.forEach(e => {
            const i = nodes.findIndex(n => n.id === e.source);
            const j = nodes.findIndex(n => n.id === e.target);
            if (i !== -1 && j !== -1) {
                edge_x.push(node_x[i], node_x[j], null);
                edge_y.push(node_y[i], node_y[j], null);
            }
        });

        const edge_trace = {
            x: edge_x, y: edge_y,
            line: { width: 1, color: '#888' },
            mode: 'lines',
            type: 'scatter'
        };

        const node_trace = {
            x: node_x, y: node_y,
            mode: 'markers+text',
            type: 'scatter',
            text: nodes.map(n => n.label),
            textposition: "bottom center",
            marker: { size: 10, color: '#1f77b4' }
        };

        Plotly.newPlot('graph', [edge_trace, node_trace], {
            margin: { t: 30 },
            title: 'Grafo de interacción de residuos'
        });
    </script>
</body>
</html>
